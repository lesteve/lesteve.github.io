
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>NiLearn: Machine learning for NeuroImaging in Python &mdash; Machine learning for NeuroImaging</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1a',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="Machine learning for NeuroImaging" href="../index.html" />
    <link rel="up" title="2. NeuroImaging data analysis pipelines" href="index.html" />
    <link rel="next" title="3. The nilearn building blocks" href="../building_blocks/index.html" />
    <link rel="prev" title="2.3. Extracting resting-state networks" href="resting_state_networks.html" />
<meta content="True" name="HandheldFriendly">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<meta name="keywords" content="nilearn, neuroimaging, python, neuroscience, machinelearning">
<script type="text/javascript">
$(function () {
    // Lock the table of content to a fixed position once we scroll enough
    var top = 105 + $('.sphinxsidebarwrapper').offset().top - parseFloat($('.sphinxsidebarwrapper').css('margin-top').replace(/auto/, 0)),
        sections = {},
        i        = 0,
	url	 = document.URL.replace(/#.*$/, ""),
	current_section = 0;

    // Grab positions of our sections 
    $('.headerlink').each(function(){
        sections[this.href.replace(url, '')] = $(this).offset().top - 50;
    });

    $(window).scroll(function(event) {
	var pos   = $(window).scrollTop();
	// Lock the table of content to a fixed position once we scroll enough
	if(pos > top){
	    //begin to scroll
	    $('.sphinxsidebarwrapper').css("position", "fixed");
	    $('.sphinxsidebarwrapper').css("top", -105);
	}
	else{
	    //lock it back into place
	    $('.sphinxsidebarwrapper').css("position", "relative");
	    $('.sphinxsidebarwrapper').css("top",0);
	}
            
	// Highlight the current section
	$('a.internal').removeClass('active');
        for(i in sections){
            if(sections[i] > pos){
		break;
            };
	    if($('a.internal[href$="' + i + '"]').is(':visible')){
		current_section = i;
	    };
        }
	$('a.internal[href$="' + current_section + '"]').addClass('active');
    });

});
</script>


<script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-41920728-1']);
        _gaq.push(['_trackPageview']);

        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>

  </head>
  <body>
<div id="logo-banner">
  <div class="logo">
    <a href="../index.html">
      <img src="../_static/nilearn-logo.png" alt="NiLearn logo"  border="0" />
    </a>
  </div>
  <!-- A tag cloud to make it easy for people to find what they are
                         looking for -->
 <div class="tags">
  <ul>
    <li>
      <big><a href="../auto_examples/plot_haxby_anova_svm.html">SVM</a></big>
    </li>
    <li>
      <small><a href="parcellating.html">Ward
          clustering</a></small>
    </li>
    <li>
      <a href="../building_blocks/haxby_searchlight.html">Searchlight</a>
    </li>
    <li>
      <big><a href="resting_state_networks.html">ICA</a></big>
    </li>
    <li>
      <a href="../building_blocks/data_preparation.html">Nifti IO</a>
    </li>
    <li>
      <a href="../modules/reference.html#module-nilearn.datasets">Datasets</a>
    </li>
  </ul>
 </div>

  <div class="banner">
    <h1>NiLearn:</h1>
    <h2>Machine learning for Neuro-Imaging in Python</h2>
  </div>
  <div class="search_form">
    <div id="cse" style="width: 100%;"></div>
    <script src="http://www.google.com/jsapi" type="text/javascript"></script>
    <script type="text/javascript">
      google.load('search', '1', {language : 'en'});
      google.setOnLoadCallback(function() {
      var customSearchControl = new google.search.CustomSearchControl('014136483057745874622:r-npolb1uki');
      customSearchControl.setResultSetSize(google.search.Search.FILTERED_CSE_RESULTSET);
      var options = new google.search.DrawOptions();
      options.setAutoComplete(true);
      customSearchControl.draw('cse', options);
      }, true);
    </script>
  </div>
</div>



    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../np-modindex.html" title="Python Module Index"
             >modules</a></li>
        <li class="right" >
          <a href="../building_blocks/index.html" title="3. The nilearn building blocks"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="resting_state_networks.html" title="2.3. Extracting resting-state networks"
             accesskey="P">previous</a> |</li>
<li><a href="../index.html">NiLearn Home</a> |&nbsp;</li>
<li><a href="../user_guide.html">User Guide</a> |&nbsp;</li>
<li><a href="../auto_examples/index.html">Examples</a> |&nbsp;</li>
<li><a href="../modules/reference.html">Reference</a> |&nbsp;</li>
<li id="navbar-about"><a href="../AUTHORS.html">About</a>|&nbsp;</li>
<li id="navbar-ecosystem"><a href="http://www.nipy.org/">Nipy ecosystem</a></li>

          <li><a href="index.html" accesskey="U">2. NeuroImaging data analysis pipelines</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">


<h4> Giving credit </h4>
  <ul class="simple">
    <li><p>Please consider <a href="../AUTHORS.html#citing">citing the
                    scikit-learn</a> if you use it.</p></li>
  </ul>

  <h3><a href="../user_guide.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">2.4. Learning functional connectomes</a><ul>
<li><a class="reference internal" href="#sparse-inverse-covariance-for-functional-connectomes">2.4.1. Sparse inverse covariance for functional connectomes</a></li>
<li><a class="reference internal" href="#testing-the-different-approaches-on-simulated-data">2.4.2. Testing the different approaches on simulated data</a><ul>
<li><a class="reference internal" href="#synthetic-signals">2.4.2.1. Synthetic signals</a></li>
<li><a class="reference internal" href="#estimation">2.4.2.2. Estimation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#a-real-data-example">2.4.3. A real-data example</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="resting_state_networks.html"
                        title="previous chapter">2.3. Extracting resting-state networks</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../building_blocks/index.html"
                        title="next chapter">3. The nilearn building blocks</a></p>

<div class="navbar">
</div> <!-- end navbar -->

<script type="text/javascript">$('#searchbox-ml').show(0);</script>
<script type="text/javascript">$('#searchbox-site').show(0);</script>


        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="learning-functional-connectomes">
<span id="functional-connectomes"></span><h1>2.4. Learning functional connectomes<a class="headerlink" href="#learning-functional-connectomes" title="Permalink to this headline">¶</a></h1>
<div class="topic">
<p class="topic-title first"><strong>Page summary</strong></p>
<p>A <em>functional connectome</em> is a set of connections representing brain
interactions between regions. Here we show the use of sparse-inverse
covariance estimators to extract functional connectomes.</p>
</div>
<div class="topic">
<p class="topic-title first"><strong>References</strong></p>
<ul class="simple">
<li><a class="reference external" href="http://www.sciencedirect.com/science/article/pii/S1053811910011602">Smith et al, Network modelling methods for FMRI,
NeuroImage 2011</a></li>
<li><a class="reference external" href="http://www.sciencedirect.com/science/article/pii/S1053811913003340">Varoquaux and Craddock, Learning and comparing functional
connectomes across subjects, NeuroImage 2013</a></li>
</ul>
</div>
<div class="section" id="sparse-inverse-covariance-for-functional-connectomes">
<h2>2.4.1. Sparse inverse covariance for functional connectomes<a class="headerlink" href="#sparse-inverse-covariance-for-functional-connectomes" title="Permalink to this headline">¶</a></h2>
<p>Resting-state functional connectivity can be obtained by estimating a
covariance matrix <strong>C</strong> for signals from different brain regions. Each
element of <strong>C</strong> gives the covariance between two brain regions. The same
information can be represented as a weighted graph, vertices being brain
regions, weights on edges being covariances (gaussian graphical model).
In turn, this graph can be interpreted as a connection graph between
brain regions, with weights giving the strength of the connection.
However, coefficients in a covariance matrix reflects direct as well as
indirect connections. Covariance matrices tend to be dense, and it is
rather difficult to extract from them only the direct connections between
two regions.</p>
<p>This can be achieved using the inverse of the covariance matrix, ie the
<em>precision matrix</em>. It contains <em>partial covariances</em>, which are
covariances between two regions conditioned on all the others. It thus
gives only direct connections between regions.</p>
<p class="centered">
<strong><a class="reference external image-reference" href="../auto_examples/plot_adhd_covariance.html"><img alt="covariance" src="../_images/plot_adhd_covariance_51.png" style="width: 312.0px; height: 234.0px;" /></a>
 <a class="reference external image-reference" href="../auto_examples/plot_adhd_covariance.html"><img alt="precision" src="../_images/plot_adhd_covariance_61.png" style="width: 312.0px; height: 234.0px;" /></a>
</strong></p><p>Sparsity in the inverse covariance matrix is important to reduce noise in
the estimated connectome by limiting the number of edges (technicaly,
this problem arises from multi-colinearity in time series, when the
number of time points is not very large compared to the number of
regions). Here we explore 2 different options to estimate sparse inverse
covariance estimates:</p>
<ul class="simple">
<li>The <a class="reference external" href="http://biostatistics.oxfordjournals.org/content/9/3/432.short">graph lasso [Friedman et al, Biostatistics 2007]</a> is useful to estimate one
inverse covariance, ie to work on single-subject data or concatenate
multi-subject data.</li>
<li>The <a class="reference external" href="http://hal.inria.fr/inria-00512451">group-sparse covariance [Varoquaux et al, NIPS 2010]</a> estimates multiple connectomes from a multi-subject dataset,
with a similar structure, but differing connection values across
subjects.</li>
</ul>
</div>
<div class="section" id="testing-the-different-approaches-on-simulated-data">
<h2>2.4.2. Testing the different approaches on simulated data<a class="headerlink" href="#testing-the-different-approaches-on-simulated-data" title="Permalink to this headline">¶</a></h2>
<div class="section" id="synthetic-signals">
<h3>2.4.2.1. Synthetic signals<a class="headerlink" href="#synthetic-signals" title="Permalink to this headline">¶</a></h3>
<p>We simulate several sets of signals, one set representing one subject,
with different precision matrices, but sharing a common sparsity pattern:
10 brain regions, for 20 subjects:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">nilearn._utils.testing</span> <span class="kn">import</span> <span class="n">generate_group_sparse_gaussian_graphs</span>

<span class="n">n_subjects</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c"># number of subjects</span>
<span class="n">n_displayed</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c"># number of subjects displayed</span>
<span class="n">subjects</span><span class="p">,</span> <span class="n">precisions</span><span class="p">,</span> <span class="n">topology</span> <span class="o">=</span> <span class="n">generate_group_sparse_gaussian_graphs</span><span class="p">(</span>
    <span class="n">n_subjects</span><span class="o">=</span><span class="n">n_subjects</span><span class="p">,</span> <span class="n">n_features</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">min_n_samples</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">max_n_samples</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
    <span class="n">density</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
<p><cite>subjects</cite> and <cite>precisions</cite> are lists containing respectively each
subject&#8217;s signals and the corresponding true precision matrices used
in the generation (ground truth). <cite>topology</cite> is a single array with
only 0 and 1 giving the common sparsity pattern.</p>
</div>
<div class="section" id="estimation">
<h3>2.4.2.2. Estimation<a class="headerlink" href="#estimation" title="Permalink to this headline">¶</a></h3>
<p>The actual estimation is performed using a <a class="reference external" href="http://scikit-learn.org/stable/modules/cross_validation.html">cross-validation</a>
scheme. This allows for selecting the regularization parameter value
for which the model generalizes best on unseen data. This is important
to get models that might be expected to be valid at the population
level.</p>
<p>A single-subject estimation can be performed using the Graph Lasso
estimator from the scikit-learn:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">sklearn.covariance</span> <span class="kn">import</span> <span class="n">GraphLassoCV</span>
<span class="n">gl</span> <span class="o">=</span> <span class="n">GraphLassoCV</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">subject</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">subjects</span><span class="p">[:</span><span class="n">n_displayed</span><span class="p">]):</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">subject</span><span class="p">)</span>
</pre></div>
</div>
<p>After calling <cite>fit</cite>, the estimated precision matrix can be plotted
using:</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="n">plot_matrix</span><span class="p">(</span><span class="n">gl</span><span class="o">.</span><span class="n">precision_</span><span class="p">)</span>
</pre></div>
</div>
<p>where <cite>plot_matrix</cite> is a convenience function to avoid repeating the
same code. It draws the matrix as an image, taking care of using a
symmetric range, so that zero values are just in the middle of the
colormap (white in that case):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">plot_matrix</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
    <span class="n">abs_max</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">RdBu_r</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s">&quot;nearest&quot;</span><span class="p">,</span>
              <span class="n">vmin</span><span class="o">=-</span><span class="n">abs_max</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">abs_max</span><span class="p">)</span>
</pre></div>
</div>
<p>It is also possible to fit a graph lasso on data from every subject at
once:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="n">gl</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">subjects</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">n_displayed</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">plot_matrix</span><span class="p">(</span><span class="n">gl</span><span class="o">.</span><span class="n">precision_</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&quot;graph lasso, all subjects</span><span class="se">\n</span><span class="s">$</span><span class="se">\\</span><span class="s">alpha=</span><span class="si">%.2f</span><span class="s">$&quot;</span> <span class="o">%</span> <span class="n">gl</span><span class="o">.</span><span class="n">alpha_</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>Running a group-sparse estimation is very similar, the estimator comes
from NiLearn this time:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">nilearn.group_sparse_covariance</span> <span class="kn">import</span> <span class="n">GroupSparseCovarianceCV</span>
<span class="n">gsc</span> <span class="o">=</span> <span class="n">GroupSparseCovarianceCV</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">gsc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">subjects</span><span class="p">)</span>
</pre></div>
</div>
<p>The results are shown on the following figure:</p>
<a class="reference external image-reference" href="../auto_examples/plot_connect_comparison.html"><img alt="../_images/plot_connect_comparison_11.png" src="../_images/plot_connect_comparison_11.png" style="width: 600.0px; height: 420.0px;" /></a>
<p>The group-sparse estimation outputs matrices with
the same sparsity pattern, but different values for the non-zero
coefficients. This is not the case for the graph lasso output, which
all have similar but different structures. Note that the graph lasso
applied to all subjects at once gives a sparsity pattern close to that
obtained with the group-sparse one, but cannot provide per-subject
information.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The complete source code for this example can be found here:
<a class="reference internal" href="../auto_examples/plot_connect_comparison.html"><em>plot_connect_comparison.py</em></a></p>
</div>
</div>
</div>
<div class="section" id="a-real-data-example">
<h2>2.4.3. A real-data example<a class="headerlink" href="#a-real-data-example" title="Permalink to this headline">¶</a></h2>
<p>For a detailed example on real data:
<a class="reference internal" href="../auto_examples/plot_adhd_covariance.html"><em>plot_adhd_covariance.py</em></a></p>
<hr class="docutils" />
<p>A lot of technical details on the algorithm used for group-sparse
estimation and its implementation can be found in <a class="reference internal" href="../developers/group_sparse_covariance.html"><em>Group-sparse covariance estimation</em></a>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../np-modindex.html" title="Python Module Index"
             >modules</a></li>
        <li class="right" >
          <a href="../building_blocks/index.html" title="3. The nilearn building blocks"
             >next</a> |</li>
        <li class="right" >
          <a href="resting_state_networks.html" title="2.3. Extracting resting-state networks"
             >previous</a> |</li>
<li><a href="../index.html">NiLearn Home</a> |&nbsp;</li>
<li><a href="../user_guide.html">User Guide</a> |&nbsp;</li>
<li><a href="../auto_examples/index.html">Examples</a> |&nbsp;</li>
<li><a href="../modules/reference.html">Reference</a> |&nbsp;</li>
<li id="navbar-about"><a href="../AUTHORS.html">About</a>|&nbsp;</li>
<li id="navbar-ecosystem"><a href="http://www.nipy.org/">Nipy ecosystem</a></li>

          <li><a href="index.html" >2. NeuroImaging data analysis pipelines</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
            &copy; INRIA Parietal 2010-2013.
          Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.3.
        <span style="padding-left: 5ex;">
          <a href="../_sources/data_analysis/functional_connectomes.txt"
        	 rel="nofollow">Show this page source</a>
        </span>
    </div>
  </body>
</html>